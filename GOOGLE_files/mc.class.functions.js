var class_menu_hover="";if($(".class-rating-block").length>0){var class_rating_chart=echarts.init(document.getElementById("class-rating")),class_rating_option={backgroundColor:"#FFF",radar:{name:{textStyle:{color:"#FFF",backgroundColor:"#545b62",borderRadius:10,padding:[3,5]}},splitNumber:4,indicator:[{name:PublicLangData.class.rating.list[1].title,max:class_rating_maxcount},{name:PublicLangData.class.rating.list[2].title,max:class_rating_maxcount},{name:PublicLangData.class.rating.list[3].title,max:class_rating_maxcount},{name:PublicLangData.class.rating.list[4].title,max:class_rating_maxcount},{name:PublicLangData.class.rating.list[5].title,max:class_rating_maxcount},{name:PublicLangData.class.rating.list[6].title,max:class_rating_maxcount},{name:PublicLangData.class.rating.list[7].title,max:class_rating_maxcount},{name:PublicLangData.class.rating.list[8].title,max:class_rating_maxcount}],radius:70},series:[{name:PublicLangData.class.rating.title,type:"radar",color:"#555",data:[{value:[class_rating_count[0]>0?class_rating_count[0]:0,class_rating_count[1]>0?class_rating_count[1]:0,class_rating_count[2]>0?class_rating_count[2]:0,class_rating_count[3]>0?class_rating_count[3]:0,class_rating_count[4]>0?class_rating_count[4]:0,class_rating_count[5]>0?class_rating_count[5]:0,class_rating_count[6]>0?class_rating_count[6]:0,class_rating_count[7]>0?class_rating_count[7]:0],name:PublicLangData.class.rating.title,areaStyle:{normal:{color:"rgba(0, 0, 0, 0.25)"}},symbol:"circle",symbolSize:6,label:{normal:{show:!1,formatter:function(a){return a.value}}}}]}]};class_rating_chart.setOption(class_rating_option)}var class_menu_page=new Swiper(".class-menu-page",{slidesPerView:"auto",freeMode:!0}),class_menu_main=new Swiper(".class-menu-main",{autoHeight:!0,effect:"fade",on:{slideChange:function(){$(".class-menu-page li").removeClass("swiper-slide-active"),$(".class-menu-page li[data-page='"+(class_menu_main.realIndex+1)+"']").addClass("swiper-slide-active")}}});function class_menu_switch(a){var t=a.parent().parent().attr("data-frame"),e=a.attr("data-id");e&&($(".class-menu-main[data-frame='"+t+"'] li.text-area").hide(),$(".class-menu-main[data-frame='"+t+"'] li[data-id='"+e+"']").show(),$(".class-menu-page[data-frame='"+t+"'] li").removeClass("active"),a.addClass("active"))}function sort_link(){var a=$(".common-center .right .class-info .class-info-left .urllink li").toArray().sort(function(a,t){return parseInt($(a).attr("data-order"))-parseInt($(t).attr("data-order"))});$(a).appendTo($(".common-center .right .class-info .class-info-left .urllink ul"))}function class_author_resize(){$(".common-center .right .class-info .class-info-left .author ul").height()>50?$(".common-center .right .class-info .class-info-left .author .fold").show():$(".common-center .right .class-info .class-info-left .author .fold").hide()}$(document).on("click",".class-menu-page li",function(){class_menu_switch($(this))}),$(document).on("mouseenter",".class-menu-page li",function(){var a=$(this);class_menu_hover=setTimeout(function(){class_menu_switch(a)},500)}),$(document).on("mouseleave",".class-menu-page li",function(){clearTimeout(class_menu_hover)}),sort_link(),$(document).on("click","#class-user-chart-btn",function(){if(!($("#class-user-chart-frame .modal-body").html().length>0)){var a={todo:"user"};a.cid=class_id;var t=JSON.stringify(a),e=$.ajax({url:"/frame/class/ClassChart/",async:!0,type:"post",data:{data:t},beforeSend:function(){$("#class-user-chart-frame .modal-body").html('<img alt="{$PublicLangData[\'loading\']}.." src="/static/public/images/loading-colourful.gif" />')},complete:function(){if(e.responseText){var a=$.parseJSON(e.responseText);0==a.state?$("#class-user-chart-frame .modal-body").html(a.html):common_msg(PublicLangData.warning.inform.title,PublicLangData.warning.inform[a.state],"err")}},error:function(a,t){connect_error(t)},timeout:timmeLimit})}}),$(document).on("click","#class-index-chart-btn",function(){if(!($("#class-index-chart-frame .modal-body").html().length>0)){var a={todo:"index"};a.cid=class_id;var t=JSON.stringify(a),e=$.ajax({url:"/frame/class/ClassChart/",async:!0,type:"post",data:{data:t},beforeSend:function(){$("#class-index-chart-frame .modal-body").html('<img alt="{$PublicLangData[\'loading\']}.." src="/static/public/images/loading-colourful.gif" />')},complete:function(){if(e.responseText){var a=$.parseJSON(e.responseText);0==a.state?$("#class-index-chart-frame .modal-body").html(a.html):common_msg(PublicLangData.warning.inform.title,PublicLangData.warning.inform[a.state],"err")}},error:function(a,t){connect_error(t)},timeout:timmeLimit})}}),$(document).on("click",".class-card .text-block span",function(){var a={todo:"cardvote"};if(a.cid=class_id,a.type=$(this).attr("data-type"),a.type)var t=JSON.stringify(a),e=$.ajax({url:"/action/doClass/",async:!0,type:"post",data:{data:t},beforeSend:function(){},complete:function(){if(e.responseText){var t=$.parseJSON(e.responseText);if(0==t.state){var s="",n="",l=sprintf(PublicLangData.class.card.already,PublicLangData.class.card.red),i=sprintf(PublicLangData.class.card.already,PublicLangData.class.card.black);1==a.type?$(".class-card .text-block span[data-type='1']").text().replace(/[^\u4e00-\u9fa5]/gi,"")==l?(s=PublicLangData.class.card.votered+": "+t.num.red+" ("+t.per.red+"%)",n=PublicLangData.class.card.voteblack+": "+t.num.black+" ("+t.per.black+"%)",common_msg(PublicLangData.remind,sprintf(PublicLangData.class.card.cancel,PublicLangData.class.card.red),"ok")):(s=l+": "+t.num.red+" ("+t.per.red+"%)",n=PublicLangData.class.card.voteblack+": "+t.num.black+" ("+t.per.black+"%)",common_msg(PublicLangData.remind,sprintf(PublicLangData.class.card.complete,PublicLangData.class.card.red),"ok")):$(".class-card .text-block span[data-type='2']").text().replace(/[^\u4e00-\u9fa5]/gi,"")==i?(s=PublicLangData.class.card.votered+": "+t.num.red+" ("+t.per.red+"%)",n=PublicLangData.class.card.voteblack+": "+t.num.black+" ("+t.per.black+"%)",common_msg(PublicLangData.remind,sprintf(PublicLangData.class.card.cancel,PublicLangData.class.card.black),"ok")):(s=PublicLangData.class.card.votered+": "+t.num.red+" ("+t.per.red+"%)",n=i+": "+t.num.black+" ("+t.per.black+"%)",common_msg(PublicLangData.remind,sprintf(PublicLangData.class.card.complete,PublicLangData.class.card.black),"ok")),$(".class-card .text-block span[data-type='1']").text(s),$(".class-card .text-block span[data-type='2']").text(n),$(".class-card .progress-bar.red").attr("aria-valuenow",t.per.red).css("width",t.per.red+"%"),$(".class-card .progress-bar.black").attr("aria-valuenow",t.per.black).css("width",t.per.black+"%")}else common_msg(PublicLangData.warning.inform.title,PublicLangData.warning.inform[t.state],"err")}},error:function(a,t){connect_error(t)},timeout:timmeLimit})}),$(document).on("click",".common-fuc-group li",function(){var a=$(this),t={};if(t.todo=$(this).attr("class"),t.cid=class_id,"push"!=t.todo&&"subscribe"!=t.todo)return!1;var e=JSON.stringify(t),s=$.ajax({url:"/action/doClass/",async:!0,type:"post",data:{data:e},beforeSend:function(){},complete:function(){if(s.responseText){var e=$.parseJSON(s.responseText);if(0==e.state){1==e.todo?common_msg(PublicLangData.remind,PublicLangData.class[t.todo].complete,"ok"):common_msg(PublicLangData.remind,PublicLangData.class[t.todo].cancel,"ok");var n=a.find("i"),l=a.children(".nums"),i=parseInt(l.attr("title")),o=a.find("span");if(n.hasClass("far"))n.removeClass("far").addClass("fas"),l.text(i+1).attr("title",i+1),o.text(PublicLangData.class[t.todo].off);else{if("push"==t.todo)return;n.removeClass("fas").addClass("far"),l.text(i-1).attr("title",i-1),o.text(PublicLangData.class[t.todo].title)}}else common_msg(PublicLangData.warning.inform.title,PublicLangData.warning.inform[e.state],"err")}},error:function(a,t){connect_error(t)},timeout:timmeLimit})}),$(document).on("click","#class-rating-submit",function(){var a={todo:"ratingvote"};a.cid=class_id,a.option={};var t=!1;$("input[data-class-rating-option='true']:checked").each(function(){var e=$(this).attr("data-type");a.option[e]=$(this).val(),0!=$(this).val()&&(t=!0)}),t?swal({title:PublicLangData.confirm,text:PublicLangData.class.rating.confirm,type:"question",confirmButtonText:PublicLangData.yes,cancelButtonText:PublicLangData.no,preConfirm:()=>{var t=JSON.stringify(a);return new Promise(function(a,e){var s=$.ajax({url:"/action/doClass/",async:!0,type:"post",data:{data:t},beforeSend:function(){swal.showLoading()},complete:function(){if(swal.hideLoading(),swal.close(),s.responseText){var a=$.parseJSON(s.responseText);0==a.state?(common_msg(PublicLangData.remind,PublicLangData.class.rating.complete,"ok"),$("#class-rating-frame").modal("hide"),$(".class-rating-content").remove(),$("#class-rating").unwrap()):common_msg(PublicLangData.warning.inform.title,PublicLangData.warning.inform[a.state],"err")}},error:function(a,t){connect_error(t)},timeout:timmeLimit})})},allowOutsideClick:()=>!Swal.isLoading(),allowEscapeKey:()=>!Swal.isLoading(),showCancelButton:()=>!Swal.isLoading()}).then(a=>{a.value&&swal.hideLoading()}):common_msg(PublicLangData.remind,PublicLangData.class.rating.empty,"ok")}),$(document).on("click","#class-relation-chart-btn",function(){var a=$(this).attr("data-id");if(!a)return!1;var t=$(".class-title h3").text(),e=0==$("#class-relation-chart").length;if(e){var s='<div class="modal fade" id="class-relation-chart" tabindex="-1" role="dialog" aria-labelledby="class-relation-chart" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document" style="min-width:100%;margin:0"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">'+t+PublicLangData.class.relation.chart.title+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><div id="class-relation-chart-tools"><button id="class-relation-chart-tobase" type="button" class="btn btn-light btn-sm"><i class="fa fa-street-view"></i>'+PublicLangData.class.relation.chart.base+'</button>\x3c!--<div class="checkbox"><input id="class-relation-chart-namefilter-main" name="class-relation-chart-namefilter" value="1" type="checkbox" checked="checked"><label for="class-relation-chart-namefilter-main">'+PublicLangData.class.relation.chart.namefilter.main+'</label></div><div class="checkbox"><input id="class-relation-chart-namefilter-sub" name="class-relation-chart-namefilter" value="1" type="checkbox" checked="checked"><label for="class-relation-chart-namefilter-sub">'+PublicLangData.class.relation.chart.namefilter.sub+'</label></div><div class="checkbox"><input id="class-relation-chart-namefilter-abbr" name="class-relation-chart-namefilter" value="1" type="checkbox" checked="checked"><label for="class-relation-chart-namefilter-abbr">'+PublicLangData.class.relation.chart.namefilter.abbr+'</label></div>--\x3e\x3c!--<div class="input-group"><label for="class-relation-chart-maxdeep">'+PublicLangData.class.relation.chart.maxdeep+'(WIP):</label><input id="class-relation-chart-maxdeep" class="form-control" name="max`" value="3" placeholder="'+PublicLangData.class.relation.chart.maxdeep+'.." maxlength="8"></div>--\x3e<div class="input-group"><label for="class-relation-chart-maxnode">'+PublicLangData.class.relation.chart.maxnode+':</label><input id="class-relation-chart-maxnode" class="form-control" name="maxnode" value="50" placeholder="'+PublicLangData.class.relation.chart.maxnode+'.." maxlength="8"></div><div id="class-relation-chart-nodecount" class="input-group">'+sprintf(PublicLangData.class.relation.chart.nodecount,"<span>-</span>")+'</div></div><div id="class-relation-chart-frame"><div id="class-relation-chart-canvas"></div><div id="class-relation-chart-loading"></div></div></div></div></div></div>';$("body").append(s)}var n=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-100;$("#class-relation-chart .modal-content, #class-relation-chart-frame").css("min-height",n),$("#class-relation-chart-canvas").css("height",n),e&&setTimeout(function(){var t,e=echarts.init(document.getElementById("class-relation-chart-canvas"));$.getJSON("/static/public/json/relation/class/"+a+".json",function(a){e.hideLoading(),a.nodes.forEach(function(a){a.label={show:a.symbolSize>5}}),$("#class-relation-chart-nodecount").children("span").text(a.nodes.length-1);var s=l(a.nodes,1e3,50);t={tooltip:{trigger:"item",renderMode:"html",formatter:function(t){if("node"==t.dataType)return'<p><b style="color:'+a.categories[t.data.category].itemStyle.normal.color+'">'+t.name+"</b></p>"+(a.nodes[t.dataIndex].content?'<p style="margin-top:5px;max-width:350px;white-space:break-spaces;">'+a.nodes[t.dataIndex].content+"</p>":"");switch(a.nodes[t.data.source].category){case 0:return'<p><span style="color:'+a.categories[a.nodes[t.data.source].category].itemStyle.normal.color+'"><b>'+a.nodes[t.data.source].name+'</b></span> 是 <span style="color:'+a.categories[a.nodes[t.data.target].category].itemStyle.normal.color+'"><b>'+a.nodes[t.data.target].name+"</b></span> 的"+a.categories[0].name+"。</p>";case 1:case 3:return'<p><span style="color:'+a.categories[a.nodes[t.data.target].category].itemStyle.normal.color+'"><b>'+a.nodes[t.data.target].name+'</b></span> 是 <span style="color:'+a.categories[a.nodes[t.data.source].category].itemStyle.normal.color+'"><b>'+a.nodes[t.data.source].name+"</b></span> 的"+a.categories[1].name+"。</p>";case 2:return'<p><span style="color:'+a.categories[a.nodes[t.data.target].category].itemStyle.normal.color+'"><b>'+a.nodes[t.data.target].name+'</b></span> 与 <span style="color:'+a.categories[a.nodes[t.data.source].category].itemStyle.normal.color+'"><b>'+a.nodes[t.data.source].name+"</b></span>联动。</p>"}}},legend:[{data:a.categories.map(function(a){return a.name})}],series:[{name:a.nodes[0].name+PublicLangData.class.relation.chart.title,type:"graph",layout:"force",data:s,links:a.links,categories:a.categories,roam:!0,scaleLimit:{min:.5,max:1.5},draggable:!0,symbol:"circle",edgeSymbol:["none","arrow"],edgeSymbolSize:[0,10],edgeSymbolOpacity:.75,label:{position:"right",formatter:"{b}",fontSize:12},lineStyle:{width:2,color:"source",curveness:0,opacity:.75},emphasis:{lineStyle:{width:5}},force:{repulsion:900,edgeLength:200,gravity:.1,friction:.2,layoutAnimation:!0}}],animationDuration:2e3,animationEasingUpdate:"quinticInOut"},e.on("finished",function(){setTimeout(function(){$("#class-relation-chart-loading").remove(),$("#class-relation-chart-canvas, #class-relation-chart-tools").animate({opacity:1},500)},2e3)}),e.on("click",function(t){if("node"==t.dataType){var e=a.nodes[t.dataIndex].classID;e&&window.open("//www.mcmod.cn/class/"+e+".html")}});var n=1;function l(a,t,e){t<1&&(t=1),e<1&&(e=1);var s=new Array,n=0;return a.forEach(function(a){(0==a.id||a.deep<=t&&n<=e)&&(s[a.id]=a,n++)}),s=s.filter(function(a){return a})}e.getZr().on("mousewheel",function(){var a=e.getOption(),t=a.series[0].zoom;t!==n&&(n=t,fontSize=(12*t).toFixed(),(t>1.5||t<.5)&&(a.series[0].roam="move",t>1.5?setTimeout(function(){a.series[0].zoom=1.49999,a.series[0].roam=!0,e.setOption(a,!1)},10):t<.5&&setTimeout(function(){a.series[0].zoom=.50001,a.series[0].roam=!0,e.setOption(a,!1)},10)),fontSize<16&&fontSize>10&&(a.series[0].label.fontSize=fontSize),e.setOption(a,!1))}),window.addEventListener("resize",()=>{e.resize()}),$(document).on("click","#class-relation-chart-tobase",function(){var a=e.getOption();a.series[0].center=e.getModel().getSeriesByIndex(0).getData()._itemLayouts[0],e.setOption(a,!1)}),$(document).on("change","#class-relation-chart-maxdeep, #class-relation-chart-maxnode",function(){var t=parseInt($("#class-relation-chart-maxnode").val().trim()),s=l(a.nodes,1e3,t),n=e.getOption();n.series[0].data=s,e.setOption(n,!1)}),e.setOption(t)})},500),$("#class-relation-chart").modal("show")}),$(document).on("click","a[data-target='#class-download-frame']",function(){var a=$(".class-title h3").text(),t=Math.round(Math.random())>.5?["You know the rules","And so do I <3"]:["Creeper?","Awwww man~!"];if(0==$("#class-download-frame").length){var e='<div class="modal fade" id="class-download-frame" tabindex="-1" role="dialog" aria-labelledby="class-download-frame" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document" style="max-width:960px;"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">'+PublicLangData.class.download.unauthorized+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body" style="line-height:28px;"><p class="text-danger">“'+a+"”在MC百科内暂未得到下载授权或正在上传中。</p><br/><p><b>我应该去哪里下载"+a+'？</b></p><p>可通过<b>“相关链接”</b>中的<span style="color:#cd9d1c">官网</span>、<span style="color:#3f75ef">网盘</span>、<span style="color:#cf6523">CurseForge</span>、<span style="color:#5da424">Modrinth</span>、<span style="color:#171515">GitHub</span> 地址下载。</p><p>如下图所示：</p><p><img alt="download links" src="//i.mcmod.cn/editor/upload/20220604/1654333844_2_cuXp.jpg" style="border:5px solid #DEDEDE;border-radius: 10px;" /></p><hr/><p><b>怎样才能在MC百科中下载'+a+'？</b></p><p><i>作者：</i></p><p>作者可以自行上传Mod，请通过本页面左侧边栏的“开发组”链接申请权限。</p><p><i>非作者：</i></p><p>玩家可向Mod作者申请取得授权，并将截图发送至 <a href="https://bbs.mcmod.cn/thread-615-1-1.html" target="_blank">[授权记录贴]</a> 中。</p><p>如果此Mod的协议条款适用于MC百科，也可以在授权记录贴中发布证明截图，如符合则会尽快添加并开放此Mod的下载。</p><br/><p><i>MC百科承诺：</i></p><p><i>得到授权后将提供与官方一致的Mod文件下载，不篡改玩法，不署名，不附加恶意文件，不捆绑任何下载器或插件。</i></p><hr/><p><b>能不能传网盘地址？</b></p><p>MC百科允许在正文中添加第三方模组下载源（如:网盘），但要符合以下任意条件：</p><ul style="list-style-type:decimal;padding-left:20px;"><li>模组作者可以在“相关链接”中为自己的模组添加下载地址，但要在备注中声明“由作者提供的下载地址”，如有提取码，需一同添加。</li><li>在已经得到作者授权，允许将下载地址发布至MC百科的情况下，或是MC百科的分发行为符合作者指定的协议时，可以将截图证明发送至<a target="_blank" href="//bbs.mcmod.cn/thread-615-1-1.html">下载授权帖</a>内等待上传，无需在正文或链接中添加。</li></ul></div><div class="modal-footer"><p class="text-secondary"></p><button type="button" class="btn btn-light" data-dismiss="modal"></button></div></div></div></div>';$("body").append(e)}$("#class-download-frame").find(".modal-footer .text-secondary").text(t[0]),$("#class-download-frame").find(".modal-footer .btn").text(t[1]),$("#class-download-frame").modal("show")}),$(document).on("click","a[data-target='#class-developer-apply-frame']",function(){if(0==$("#class-developer-apply-frame").length){var a='<div class="modal fade" id="class-developer-apply-frame" tabindex="-1" role="dialog" aria-labelledby="class-developer-apply-frame" aria-hidden="true"><div class="modal-dialog modal-dialog-centered" role="document" style="max-width:960px;"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">'+PublicLangData.apply+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body" style="line-height:28px;"><p><b>申请开发者的条件是什么？</b></p><p>申请者必须为模组核心开发成员，非核心参与人员必须在征得核心成员的同意后才能申请。</p><br/><p><b>如何申请开发者？</b></p><p>请将以下申请材料发送至邮箱 admin@mcmod.cn：</p><ul style="list-style-type:decimal;padding-left:20px;"><li>模组在百科的ID（见模组地址栏）；</li><li>申请者的用户ID（见个人中心地址栏）；</li><li>开发者证明（需用具有说服力的方式证明）。</li></ul><br/><p><b>开发者会有哪些功能？</b></p><ul style="list-style-type:decimal;padding-left:20px;"><li>模组开发者可以上传模组文件，可通过“头像菜单->文件管理”进入文件管理界面；</li><li>模组开发者会在模组短评与个人中心内显示醒目的标识。</li></ul></div><div class="modal-footer"><button type="button" class="btn btn-light" data-dismiss="modal">'+PublicLangData.close+"</button></div></div></div></div>";$("body").append(a)}$("#class-developer-apply-frame").modal("show")}),class_author_resize(),$(window).resize(function(){class_author_resize()}),$(document).on("click",".common-center .right .class-info .class-info-left .author .fold",function(){$(this).text()==PublicLangData.class.author.fold.down?($(".common-center .right .class-info .class-info-left .author .frame").css("height","auto"),$(this).html('<i class="fas fa-chevron-up"></i>'+PublicLangData.class.author.fold.up)):($(".common-center .right .class-info .class-info-left .author .frame").css("height",""),$(this).html('<i class="fas fa-chevron-down"></i>'+PublicLangData.class.author.fold.down))});